<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حساب OVR للفريق - FC Mobile 25</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
    :root {
        --bg-color: linear-gradient(135deg, #0f2e6f 0%, #1a56db 100%);
        --container-bg: rgba(255, 255, 255, 0.1);
        --text-color: white;
        --highlight-color: #ffcc00;
        --input-bg: rgba(255, 255, 255, 0.9);
        --input-text: #1f2937;
        --border-color: rgba(255, 255, 255, 0.2);
        --result-bg: rgba(255, 255, 255, 0.15);
        --error-color: #e53e3e;
        --btn-hover-color: #ffd633;
        --modal-bg: rgba(0, 0, 0, 0.6);
        --modal-content-bg: #1f2937;
    }

    /* Light Theme */
    body.light-theme {
        --bg-color: #f0f2f5;
        --container-bg: rgba(255, 255, 255, 0.8);
        --text-color: #1f2937;
        --highlight-color: #1a56db;
        --input-bg: rgba(255, 255, 255, 1);
        --input-text: #1f2937;
        --border-color: rgba(0, 0, 0, 0.1);
        --result-bg: rgba(26, 86, 219, 0.1);
        --error-color: #e53e3e;
        --btn-hover-color: #1646b0;
        --modal-bg: rgba(0, 0, 0, 0.4);
        --modal-content-bg: #ffffff;
    }
    
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        transition: color 0.3s, background-color 0.3s, border-color 0.3s;
    }
    
    body {
        background: var(--bg-color);
        color: var(--text-color);
        min-height: 100vh;
        /* Using clamp() for responsive padding */
        padding: clamp(10px, 5vw, 40px);
        overflow-x: hidden; /* Prevents horizontal scrolling */
    }
    
    .container {
        max-width: 500px;
        margin: 0 auto;
        background-color: var(--container-bg);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        /* Using clamp() for responsive padding */
        padding: clamp(15px, 5vw, 30px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    
    header {
        text-align: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
    }
    
    h1 {
        /* Using clamp() for responsive font size */
        font-size: clamp(1.5rem, 4vw, 2.2rem);
        margin-bottom: 5px;
        color: var(--highlight-color);
    }
    
    .subtitle {
        font-size: 0.9rem;
        opacity: 0.8;
    }
    
    .settings-bar {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-bottom: 20px;
    }

    #language-select, #theme-toggle {
        padding: 6px;
        width: 120px; /* Smaller width */
        border: none;
        border-radius: 8px;
        background-color: var(--input-bg);
        color: var(--input-text);
        cursor: pointer;
        font-size: 0.85rem;
        flex-shrink: 0; /* Prevents items from shrinking */
    }

    #theme-toggle {
        width: 40px;
    }
    
    .instructions {
        margin-bottom: 20px;
        padding: 15px;
        background-color: var(--container-bg);
        border-radius: 10px;
        font-size: 0.9rem;
        line-height: 1.5;
    }
    
    .instructions h3 {
        margin-bottom: 10px;
        color: var(--highlight-color);
    }
    
    .team-section {
        margin-bottom: 20px;
    }
    
    .section-title {
        margin-bottom: 15px;
        padding-bottom: 5px;
        border-bottom: 1px solid var(--border-color);
        color: var(--highlight-color);
    }
    
    .player-row {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        gap: 10px;
        /* Allow wrapping for very small screens */
        flex-wrap: wrap; 
    }
    
    .player-label {
        flex: 1 1 100px; /* Allows it to grow/shrink but with a base size */
        font-weight: 500;
        text-align: center; /* Center on smaller screens */
    }
    
    .player-input, .rank-input {
        flex: 1 1 calc(50% - 10px); /* Distributes space more evenly on a single line */
    }

    input, select {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background-color: var(--input-bg);
        color: var(--input-text);
        font-size: 1rem;
        text-align: center;
        appearance: none;
    }
    
    input:invalid {
        border: 2px solid var(--error-color);
    }
    
    .btn {
        padding: 12px 15px;
        background-color: var(--highlight-color);
        color: var(--input-text);
        border: none;
        border-radius: 5px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, background-color 0.2s;
        touch-action: manipulation; /* Improves mobile button responsiveness */
    }

    body.light-theme .btn {
        color: white;
    }
    
    .btn:hover {
        background-color: var(--btn-hover-color);
        transform: translateY(-2px);
    }
    
    .btn:active {
        transform: translateY(0);
    }
    
    .btn-block {
        width: 100%;
        padding: 14px;
        margin-top: 10px;
    }
    
    .btn-danger {
        background-color: var(--error-color);
        color: white;
    }
    
    .result {
        margin-top: 25px;
        text-align: center;
        padding: 20px;
        background-color: var(--result-bg);
        border-radius: 10px;
        display: none;
    }
    
    .result.show {
        display: block;
        animation: fadeIn 0.5s;
    }
    
    .ovr-value {
        font-size: 3rem;
        font-weight: 700;
        color: var(--highlight-color);
        margin: 10px 0;
    }
    
    .calculation-details {
        margin-top: 15px;
        padding: 10px;
        background-color: var(--container-bg);
        border-radius: 8px;
        text-align: right;
        font-size: 0.9rem;
    }

    body.light-theme .calculation-details {
        text-align: left;
    }
    
    .formula {
        font-size: 0.9rem;
        margin-top: 10px;
        opacity: 0.8;
    }
    
    footer {
        text-align: center;
        margin-top: 30px;
        font-size: 0.8rem;
        opacity: 0.7;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    /* Small screen adjustments */
    @media (max-width: 480px) {
        .player-row {
            flex-direction: column;
            gap: 5px;
            align-items: stretch;
        }
        
        .player-label {
            width: 100%; /* Full width for better stacking */
            text-align: center;
        }

        .player-input, .rank-input {
            flex: 1 1 100%; /* Ensures they take full width on separate lines */
            width: 100%;
        }

        .calculation-details {
            text-align: center;
        }
    }

    /* Additional adjustment for medium screens, to handle input sizes */
    @media (min-width: 481px) and (max-width: 768px) {
        .player-input, .rank-input {
            flex: 1 1 calc(50% - 10px);
        }
        .player-label {
            text-align: left;
        }
    }

    /* Custom Modal Styles */
    .custom-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: var(--modal-bg);
        backdrop-filter: blur(5px);
        justify-content: center;
        align-items: center;
    }

    .custom-modal.show {
        display: flex;
    }

    .modal-content {
        background-color: var(--modal-content-bg);
        margin: auto;
        padding: clamp(15px, 5vw, 30px);
        border-radius: 10px;
        width: 90%;
        max-width: 350px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        text-align: center;
    }

    .modal-message {
        margin-bottom: 20px;
        font-size: 1rem;
        line-height: 1.5;
        color: var(--text-color);
    }
    
    body.light-theme .modal-message {
        color: var(--input-text);
    }

    .modal-buttons {
        display: flex;
        justify-content: space-around;
        gap: 10px;
    }

    .modal-buttons .btn {
        flex-grow: 1;
    }
</style>
</head>
<body>
    <div class="container">
        <div class="settings-bar">
            <select id="language-select">
                <option value="ar">العربية</option>
                <option value="en">English</option>
            </select>
            <button id="theme-toggle" class="btn" aria-label="Toggle theme">
                <i class="fas fa-sun"></i>
            </button>
        </div>

        <header>
            <h1 data-key="title">حساب OVR للفريق - FC Mobile 25</h1>
            <p class="subtitle" data-key="subtitle">احسب معدل فريقك بدون اتصال بالإنترنت</p>
        </header>
        
        <div class="instructions">
            <h3 data-key="howToUse">كيفية الاستخدام</h3>
            <p data-key="step1">1. اختر التشكيلة التي تريدها لللاعبين الأساسيين.</p>
            <p data-key="step2-dropdown">2. أدخل OVR الأساسي لكل لاعب أساسي واختر عدد التطويرات.</p>
            <p data-key="step3-optional">3. (اختياري) أدخل OVR وعدد التطويرات للاعبين الاحتياطيين.</p>
            <p data-key="step4">4. انقر على "احسب معدل الفريق" لرؤية النتيجة.</p>
            <p data-key="step5">5. يتم حساب OVR الأساسي والتطويرات بشكل منفصل ثم جمعهما.</p>
            <p data-key="offlineNotice">هذا التطبيق يعمل بدون اتصال بالإنترنت.</p>
        </div>
        
        <div class="team-section">
            <h3 class="section-title" data-key="formationSection">اختر التشكيلة</h3>
            <select id="formation-select">
                <option value="4-3-3 Attack">4-3-3 Attack</option>
                <option value="4-2-3-1 Narrow">4-2-3-1 Narrow</option>
                <option value="4-1-2-1-2 Wide">4-1-2-1-2 Wide</option>
                <option value="4-4-2 Flat">4-4-2 Flat</option>
                <option value="3-4-3 Flat">3-4-3 Flat</option>
                <option value="3-4-2-1">3-4-2-1</option>
                <option value="4-3-3">4-3-3</option>
                <option value="4-5-1">4-5-1</option>
                <option value="5-4-1">5-4-1</option>
                <option value="5-2-1-2">5-2-1-2</option>
                <option value="4-5-1 Flat">4-5-1 Flat</option>
                <option value="3-5-1-1">3-5-1-1</option>
                <option value="4-3-3 Holding">4-3-3 Holding</option>
                <option value="4-1-4-1">4-1-4-1</option>
                <option value="4-3-2-1">4-3-2-1</option>
                <option value="4-2-4">4-2-4</option>
                <option value="3-5-2">3-5-2</option>
                <option value="4-3-3 Defend">4-3-3 Defend</option>
                <option value="5-3-2">5-3-2</option>
                <option value="4-2-2-2">4-2-2-2</option>
                <option value="4-2-3-1 Wide">4-2-3-1 Wide</option>
                <option value="3-4-3 Diamond">3-4-3 Diamond</option>
                <option value="4-4-2 Holding">4-4-2 Holding</option>
                <option value="4-3-1-2">4-3-1-2</option>
                <option value="4-1-2-1-2 Narrow">4-1-2-1-2 Narrow</option>
                <option value="4-4-1-1 Attack">4-4-1-1 Attack</option>
                <option value="3-4-1-2">3-4-1-2</option>
                <option value="5-2-2-1">5-2-2-1</option>
                <option value="4-3-3 False 9">4-3-3 False 9</option>
            </select>
        </div>
        
        <div class="team-section">
            <h3 class="section-title" data-key="startingPlayersSection">اللاعبين الأساسيين (11 لاعب)</h3>
            <div id="starting-players"></div>
        </div>
        
        <div class="team-section">
            <h3 class="section-title" data-key="substitutePlayersSection">اللاعبين الاحتياطيين (7 لاعبين)</h3>
            <div id="substitute-players"></div>
        </div>
        
        <button id="calculate-btn" class="btn btn-block" data-key="calculateBtn">احسب معدل الفريق</button>
        <button id="reset-btn" class="btn btn-block btn-danger" data-key="resetBtn">إعادة تعيين</button>
        
        <div class="result" id="result">
            <h2 data-key="finalOvrTitle">معدل الفريق العام</h2>
            <div class="ovr-value" id="ovr-value">0</div>
            
            <div class="calculation-details">
                <p id="base-ovr-sum" data-key="baseOvrSum">مجموع OVR الأساسي: 0</p>
                <p id="rank-ups-sum" data-key="rankUpsSum">مجموع التطويرات: 0</p>
                <p id="base-ovr-avg" data-key="baseOvrAvg">متوسط OVR الأساسي: 0</p>
                <p id="rank-ups-avg" data-key="rankUpsAvg">متوسط التطويرات: 0</p>
                <p id="raw-calculation" data-key="rawCalculation">الحساب الأولي: 0</p>
            </div>
            
            <p class="formula" data-key="formula">(مجموع OVR الأساسي ÷ عدد اللاعبين) + (مجموع التطويرات ÷ عدد اللاعبين)</p>
        </div>
        
        <footer>
            <p data-key="footer">تطبيق حساب OVR للفريق - FC Mobile 25 ©</p>
        </footer>
    </div>

    <!-- Custom Modal -->
    <div id="custom-modal" class="custom-modal">
        <div class="modal-content">
            <p class="modal-message" id="modal-message"></p>
            <div class="modal-buttons">
                <button id="modal-ok-btn" class="btn">موافق</button>
                <button id="modal-cancel-btn" class="btn btn-danger" style="display:none;">إلغاء</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-btn');
            // Add this inside generateStartingPlayers and generateSubstitutePlayers
            const rankSelectElement = playerRow.querySelector('select');
            rankSelectElement.title = "اختر عدد التطويرات (Rank-ups)"; // Arabic tooltip
            // For English, you can check the language and change accordingly
            if(lang === 'en') {
                rankSelectElement.title = "Select number of rank-ups";
            }

            const resetBtn = document.getElementById('reset-btn');
            const resultDiv = document.getElementById('result');
            const ovrValue = document.getElementById('ovr-value');
            const startingPlayersDiv = document.getElementById('starting-players');
            const substitutePlayersDiv = document.getElementById('substitute-players');
            const languageSelect = document.getElementById('language-select');
            const themeToggle = document.getElementById('theme-toggle');
            const formationSelect = document.getElementById('formation-select');
            
            const elementsToTranslate = document.querySelectorAll('[data-key]');
            
            // Custom Modal Elements
            const customModal = document.getElementById('custom-modal');
            const modalMessage = document.getElementById('modal-message');
            const modalOkBtn = document.getElementById('modal-ok-btn');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');

            // Custom alert and confirm functions
            function showAlert(message) {
                modalMessage.textContent = message;
                modalCancelBtn.style.display = 'none';
                customModal.classList.add('show');
                modalOkBtn.onclick = () => {
                    customModal.classList.remove('show');
                };
            }

            function showConfirm(message, onConfirm) {
                modalMessage.textContent = message;
                modalCancelBtn.style.display = 'inline-block';
                customModal.classList.add('show');
                modalOkBtn.onclick = () => {
                    customModal.classList.remove('show');
                    if (onConfirm) onConfirm();
                };
                modalCancelBtn.onclick = () => {
                    customModal.classList.remove('show');
                };
            }
            
            const translations = {
                ar: {
                    title: 'حساب OVR للفريق - FC Mobile 25',
                    subtitle: 'احسب معدل فريقك بدون اتصال بالإنترنت',
                    howToUse: 'كيفية الاستخدام',
                    step1: '1. اختر التشكيلة التي تريدها لللاعبين الأساسيين.',
                    step2_dropdown: '2. أدخل OVR الأساسي لكل لاعب أساسي واختر عدد التطويرات.',
                    step3_optional: '3. (اختياري) أدخل OVR وعدد التطويرات للاعبين الاحتياطيين.',
                    step4: '4. انقر على "احسب معدل الفريق" لرؤية النتيجة.',
                    step5: '5. يتم حساب OVR الأساسي والتطويرات بشكل منفصل ثم جمعهما.',
                    offlineNotice: 'هذا التطبيق يعمل بدون اتصال بالإنترنت.',
                    formationSection: 'اختر التشكيلة',
                    startingPlayersSection: 'اللاعبين الأساسيين (11 لاعب)',
                    substitutePlayersSection: 'اللاعبين الاحتياطيين (7 لاعبين)',
                    calculateBtn: 'احسب معدل الفريق',
                    resetBtn: 'إعادة تعيين',
                    finalOvrTitle: 'معدل الفريق العام',
                    baseOvrSum: 'مجموع OVR الأساسي: ',
                    rankUpsSum: 'مجموع التطويرات: ',
                    baseOvrAvg: 'متوسط OVR الأساسي: ',
                    rankUpsAvg: 'متوسط التطويرات: ',
                    rawCalculation: 'الحساب الأولي: ',
                    formula: '(مجموع OVR الأساسي ÷ عدد اللاعبين) + (مجموع التطويرات ÷ عدد اللاعبين)',
                    footer: 'تطبيق حساب OVR للفريق - FC Mobile 25 ©',
                    ovrPlaceholder: 'OVR الأساسي',
                    subOvrPlaceholder: 'OVR (اختياري)',
                    alertMessage: 'يرجى ملء جميع حقول اللاعبين الأساسيين.',
                    confirmMessage: 'هل أنت متأكد من أنك تريد إعادة تعيين جميع الحقول؟',
                    rankUpsRoundedUp: ' (مقرب لأعلى: ',
                    rankUpsUsed: ' (استخدمنا ',
                    rankUpsFor: ' للتطويرات)',
                    playerLabel: 'لاعب'
                },
                en: {
                    title: 'Team OVR Calculator - FC Mobile 25',
                    subtitle: 'Calculate your team’s rating offline',
                    howToUse: 'How to Use',
                    step1: '1. Select the formation for your starting players.',
                    step2_dropdown: '2. Enter the base OVR for each starting player and select the rank-ups.',
                    step3_optional: '3. (Optional) Enter OVR and rank-ups for substitute players.',
                    step4: '4. Click "Calculate Team OVR" to see the result.',
                    step5: '5. The base OVR and rank-ups are calculated separately then added together.',
                    offlineNotice: 'This app works offline.',
                    formationSection: 'Select Formation',
                    startingPlayersSection: 'Starting Players (11 Players)',
                    substitutePlayersSection: 'Substitute Players (7 Players)',
                    calculateBtn: 'Calculate Team OVR',
                    resetBtn: 'Reset',
                    finalOvrTitle: 'Overall Team Rating',
                    baseOvrSum: 'Total Base OVR: ',
                    rankUpsSum: 'Total Rank-ups: ',
                    baseOvrAvg: 'Average Base OVR: ',
                    rankUpsAvg: 'Average Rank-ups: ',
                    rawCalculation: 'Raw Calculation: ',
                    formula: '(Total Base OVR ÷ Player Count) + (Total Rank-ups ÷ Player Count)',
                    footer: 'Team OVR Calculator - FC Mobile 25 ©',
                    ovrPlaceholder: 'Base OVR',
                    subOvrPlaceholder: 'OVR (Optional)',
                    alertMessage: 'Please fill in all the starting players fields.',
                    confirmMessage: 'Are you sure you want to reset all fields?',
                    rankUpsRoundedUp: ' (Rounded up: ',
                    rankUpsUsed: ' (Used ',
                    rankUpsFor: ' for Rank-ups)',
                    playerLabel: 'Player'
                }
            };
            
            const playerLabels = {
                'ar': {
                    'GK': 'GK', 'CB': 'CB', 'LB': 'LB', 'RB': 'RB',
                    'CM': 'CM', 'CDM': 'CDM', 'CAM': 'CAM',
                    'LM': 'LM', 'RM': 'RM', 'LW': 'LW',
                    'RW': 'RW', 'ST': 'ST', 'LWB': 'LWB', 
                    'RWB': 'RWB', 'LF': 'LF', 'RF': 'RF',
                    'SS': 'SS', 'CF': 'CF'
                },
                'en': {
                    'GK': 'GK', 'CB': 'CB', 'LB': 'LB', 'RB': 'RB',
                    'CM': 'CM', 'CDM': 'CDM', 'CAM': 'CAM',
                    'LM': 'LM', 'RM': 'RM', 'LW': 'LW',
                    'RW': 'RW', 'ST': 'ST', 'LWB': 'LWB', 
                    'RWB': 'RWB', 'LF': 'LF', 'RF': 'RF',
                    'SS': 'SS', 'CF': 'CF'
                }
            };

            const formations = {
                '4-3-3 Attack': ['GK', 'LB', 'CB', 'CB', 'RB', 'CM', 'CM', 'CAM', 'LW', 'RW', 'ST'],
                '4-2-3-1 Narrow': ['GK', 'LB', 'CB', 'CB', 'RB', 'CDM', 'CDM', 'CAM', 'CAM', 'CAM', 'ST'],
                '4-1-2-1-2 Wide': ['GK', 'LB', 'CB', 'CB', 'RB', 'CDM', 'LM', 'RM', 'CAM', 'ST', 'ST'],
                '4-4-2 Flat': ['GK', 'LB', 'CB', 'CB', 'RB', 'LM', 'CM', 'CM', 'RM', 'ST', 'ST'],
                '3-4-3 Flat': ['GK', 'CB', 'CB', 'CB', 'LM', 'CM', 'CM', 'RM', 'LW', 'RW', 'ST'],
                '3-4-2-1': ['GK', 'CB', 'CB', 'CB', 'LM', 'CM', 'CM', 'RM', 'LF', 'RF', 'ST'],
                '4-3-3': ['GK', 'LB', 'CB', 'CB', 'RB', 'CM', 'CM', 'CM', 'LW', 'RW', 'ST'],
                '4-5-1': ['GK', 'LB', 'CB', 'CB', 'RB', 'LM', 'CM', 'CM', 'CM', 'RM', 'ST'],
                '5-4-1': ['GK', 'LWB', 'CB', 'CB', 'CB', 'RWB', 'LM', 'CM', 'CM', 'RM', 'ST'],
                '5-2-1-2': ['GK', 'LWB', 'CB', 'CB', 'CB', 'RWB', 'CM', 'CM', 'CAM', 'ST', 'ST'],
                '4-5-1 Flat': ['GK', 'LB', 'CB', 'CB', 'RB', 'LM', 'CM', 'CM', 'CM', 'RM', 'ST'],
                '3-5-1-1': ['GK', 'CB', 'CB', 'CB', 'LM', 'CDM', 'CM', 'CM', 'RM', 'CAM', 'ST'],
                '4-3-3 Holding': ['GK', 'LB', 'CB', 'CB', 'RB', 'CDM', 'CM', 'CM', 'LW', 'RW', 'ST'],
                '4-1-4-1': ['GK', 'LB', 'CB', 'CB', 'RB', 'CDM', 'LM', 'CM', 'CM', 'RM', 'ST'],
                '4-3-2-1': ['GK', 'LB', 'CB', 'CB', 'RB', 'CM', 'CM', 'CM', 'LF', 'RF', 'ST'],
                '4-2-4': ['GK', 'LB', 'CB', 'CB', 'RB', 'CDM', 'CDM', 'LW', 'RW', 'ST', 'ST'],
                '3-5-2': ['GK', 'CB', 'CB', 'CB', 'LM', 'CDM', 'CM', 'CM', 'RM', 'ST', 'ST'],
                '4-3-3 Defend': ['GK', 'LB', 'CB', 'CB', 'RB', 'CDM', 'CDM', 'CM', 'LW', 'RW', 'ST'],
                '5-3-2': ['GK', 'LWB', 'CB', 'CB', 'CB', 'RWB', 'CM', 'CM', 'CM', 'ST', 'ST'],
                '4-2-2-2': ['GK', 'LB', 'CB', 'CB', 'RB', 'CDM', 'CDM', 'CAM', 'CAM', 'ST', 'ST'],
                '4-2-3-1 Wide': ['GK', 'LB', 'CB', 'CB', 'RB', 'CDM', 'CDM', 'LM', 'CAM', 'RM', 'ST'],
                '3-4-3 Diamond': ['GK', 'CB', 'CB', 'CB', 'LM', 'CDM', 'CAM', 'RM', 'LW', 'RW', 'ST'],
                '4-4-2 Holding': ['GK', 'LB', 'CB', 'CB', 'RB', 'CDM', 'CM', 'CM', 'RM', 'ST', 'ST'],
                '4-3-1-2': ['GK', 'LB', 'CB', 'CB', 'RB', 'CDM', 'CM', 'CM', 'CAM', 'ST', 'ST'],
                '4-1-2-1-2 Narrow': ['GK', 'LB', 'CB', 'CB', 'RB', 'CDM', 'CM', 'CM', 'CAM', 'ST', 'ST'],
                '4-4-1-1 Attack': ['GK', 'LB', 'CB', 'CB', 'RB', 'LM', 'CM', 'CM', 'RM', 'SS', 'ST'],
                '3-4-1-2': ['GK', 'CB', 'CB', 'CB', 'LM', 'CDM', 'CAM', 'RM', 'CAM', 'ST', 'ST'],
                '5-2-2-1': ['GK', 'LWB', 'CB', 'CB', 'CB', 'RWB', 'CM', 'CM', 'LW', 'RW', 'ST'],
                '4-3-3 False 9': ['GK', 'LB', 'CB', 'CB', 'RB', 'CM', 'CM', 'CM', 'LW', 'RW', 'CF']
            };

            function updateUI(lang) {
                document.documentElement.lang = lang;
                document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

                elementsToTranslate.forEach(el => {
                    const key = el.dataset.key;
                    if (translations[lang] && translations[lang][key]) {
                        el.textContent = translations[lang][key];
                    }
                });
                
                // Regenerate player fields to update labels
                generateStartingPlayers(formationSelect.value, lang);
                generateSubstitutePlayers(lang);
            }

            function generateStartingPlayers(formation, lang) {
                startingPlayersDiv.innerHTML = '';
                const positions = formations[formation];
                const rankUpOptions = Array.from({ length: 6 }, (_, i) => `<option value="${i}">${i}</option>`).join('');

                positions.forEach((position, index) => {
                    const playerRow = document.createElement('div');
                    playerRow.className = 'player-row';
                    const positionLabel = playerLabels[lang][position] || position;
                    const playerId = `start-${formation}-${position}-${index}`;
                    
                    playerRow.innerHTML = `
                        <div class="player-label">${positionLabel}</div>
                        <div class="player-input">
                            <input type="number" id="${playerId}-ovr" min="45" max="111" required placeholder="${translations[lang].ovrPlaceholder}">
                        </div>
                        <div class="rank-input">
                            <select id="${playerId}-rank" required>
                                <option value="" disabled selected></option>
                                ${rankUpOptions}
                            </select>
                        </div>
                    `;
                    startingPlayersDiv.appendChild(playerRow);
                });
                
                loadSavedData();
                addEventListenersToInputs();
            }

            function generateSubstitutePlayers(lang) {
                substitutePlayersDiv.innerHTML = '';
                const rankUpOptions = Array.from({ length: 6 }, (_, i) => `<option value="${i}">${i}</option>`).join('');

                for (let i = 1; i <= 7; i++) {
                    const playerRow = document.createElement('div');
                    playerRow.className = 'player-row';
                    const playerId = `sub-player-${i}`;
                    
                    playerRow.innerHTML = `
                        <div class="player-label">${translations[lang].playerLabel} ${i}</div>
                        <div class="player-input">
                            <input type="number" id="${playerId}-ovr" min="45" max="111" placeholder="${translations[lang].subOvrPlaceholder}">
                        </div>
                        <div class="rank-input">
                            <select id="${playerId}-rank">
                                <option value="" selected></option>
                                ${rankUpOptions}
                            </select>
                        </div>
                    `;
                    substitutePlayersDiv.appendChild(playerRow);
                }
                
                loadSavedData();
                addEventListenersToInputs();
            }

            function loadAndApplySettings() {
                const savedLang = localStorage.getItem('fcMobileLang') || 'ar';
                const savedTheme = localStorage.getItem('fcMobileTheme') || 'dark';
                const savedFormation = localStorage.getItem('fcMobileFormation') || '4-3-3 Attack';

                languageSelect.value = savedLang;
                formationSelect.value = savedFormation;
                
                if (savedTheme === 'light') {
                    document.body.classList.add('light-theme');
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                } else {
                    document.body.classList.remove('light-theme');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                }
                
                updateUI(savedLang); // Call updateUI after setting language
            }

            function saveData() {
                const data = {};
                const allPlayers = document.querySelectorAll('#starting-players .player-row, #substitute-players .player-row');
                allPlayers.forEach(row => {
                    const ovrInput = row.querySelector('input');
                    const rankSelect = row.querySelector('select');
                    data[ovrInput.id] = ovrInput.value;
                    data[rankSelect.id] = rankSelect.value;
                });
                localStorage.setItem('fcMobileTeamData', JSON.stringify(data));
                localStorage.setItem('fcMobileFormation', formationSelect.value);
            }
            
            function loadSavedData() {
                const savedData = localStorage.getItem('fcMobileTeamData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    for (const id in data) {
                        const element = document.getElementById(id);
                        if (element) {
                            element.value = data[id];
                        }
                    }
                }
            }
            
            
            function addEventListenersToInputs() {
                const allInputsAndSelects = document.querySelectorAll('input, select');
                allInputsAndSelects.forEach(el => {
                    el.addEventListener('change', function() {
                        if (el.tagName === 'INPUT') {
                            const min = parseInt(this.min);
                            const max = parseInt(this.max);
                            if (!isNaN(min) && !isNaN(max)) {
                                if (this.value < min) this.value = min;
                                if (this.value > max) this.value = max;
                            }
                        }
                        saveData();
                    });
                    el.addEventListener('input', saveData);
                });
            }

            loadAndApplySettings();
            
            calculateBtn.addEventListener('click', function() {
                let totalBaseOvr = 0;
                let totalRankUps = 0;
                let playerCount = 0;
                let allStartingPlayersFilled = true;
                
                const startingRows = startingPlayersDiv.querySelectorAll('.player-row');
                startingRows.forEach(row => {
                    const ovrInput = row.querySelector('input');
                    const rankSelect = row.querySelector('select');
                    
                    if (!ovrInput.value || rankSelect.value === '') {
                        allStartingPlayersFilled = false;
                    }
                    
                    totalBaseOvr += parseFloat(ovrInput.value);
                    totalRankUps += parseFloat(rankSelect.value);
                    playerCount++;
                });

                if (!allStartingPlayersFilled) {
                    showAlert(translations[languageSelect.value].alertMessage);
                    return;
                }

                const substituteRows = substitutePlayersDiv.querySelectorAll('.player-row');
                substituteRows.forEach(row => {
                    const ovrInput = row.querySelector('input');
                    const rankSelect = row.querySelector('select');
                    
                    if (ovrInput.value !== '') {
                        totalBaseOvr += parseFloat(ovrInput.value);
                        totalRankUps += parseFloat(rankSelect.value);
                        playerCount++;
                    }
                });
                
                const baseOvrAvg = totalBaseOvr / playerCount;
                const rankUpsAvg = totalRankUps / playerCount;
                const rankUpsUsed = Math.ceil(rankUpsAvg);
                const rawOvr = baseOvrAvg + rankUpsUsed;
                const teamOvr = Math.ceil(rawOvr);
                
                const lang = languageSelect.value;
                document.getElementById('base-ovr-sum').textContent = `${translations[lang].baseOvrSum} ${totalBaseOvr}`;
                document.getElementById('rank-ups-sum').textContent = `${translations[lang].rankUpsSum} ${totalRankUps}`;
                document.getElementById('base-ovr-avg').textContent = `${translations[lang].baseOvrAvg} ${baseOvrAvg.toFixed(6)}`;
                document.getElementById('rank-ups-avg').textContent = `${translations[lang].rankUpsAvg} ${rankUpsAvg.toFixed(6)}${translations[lang].rankUpsRoundedUp}${rankUpsUsed})`;
                document.getElementById('raw-calculation').textContent = `${translations[lang].rawCalculation} ${rawOvr.toFixed(6)}${translations[lang].rankUpsUsed}${rankUpsUsed}${translations[lang].rankUpsFor}`;

                ovrValue.textContent = teamOvr;
                resultDiv.classList.add('show');
                resultDiv.scrollIntoView({ behavior: 'smooth' });
                saveData();
            });
            
            resetBtn.addEventListener('click', function() {
                showConfirm(translations[languageSelect.value].confirmMessage, () => {
                    const allInputsAndSelects = document.querySelectorAll('input, select');
                    allInputsAndSelects.forEach(el => {
                        if (el.tagName === 'SELECT') {
                            el.value = '';
                        } else {
                            el.value = '';
                        }
                    });
                    // Reset starting players dropdowns to be unselected
                    const startingRankSelects = startingPlayersDiv.querySelectorAll('select');
                    startingRankSelects.forEach(sel => sel.value = '');
                    resultDiv.classList.remove('show');
                    localStorage.removeItem('fcMobileTeamData');
                });
            });

            languageSelect.addEventListener('change', function() {
                const newLang = this.value;
                localStorage.setItem('fcMobileLang', newLang);
                updateUI(newLang);
            });

            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('light-theme');
                const isLightTheme = document.body.classList.contains('light-theme');
                const theme = isLightTheme ? 'light' : 'dark';
                localStorage.setItem('fcMobileTheme', theme);
                themeToggle.innerHTML = isLightTheme ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
            });
            
            formationSelect.addEventListener('change', function() {
                const newFormation = this.value;
                localStorage.setItem('fcMobileFormation', newFormation);
                generateStartingPlayers(newFormation, languageSelect.value);
            });
        });
    </script>
</body>
</html>